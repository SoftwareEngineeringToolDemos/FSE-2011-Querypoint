<html>
    <head>
        <title>
            Case 1: Salary Calculation.
        </title>
        <script type="text/javascript">

        <!--
            var compute = function(){
                var records = getRecords();
                console.log("start");
                sortRecords(records)
                var salarySummary = calculateTax(records);
                calculateSalary(salarySummary);
                console.log("end");
            };

            var sortRecords = function(records){
                var list = [];
                for (var p in records)
                    list.push(records[p]);
                list.sort(function(a,b){return a.salary-b.salary;});
            };

            var calculateTax = function(records){
                result = [];
                for (var p in records){
                    var record = records[p];
                    var summary = {};
                    summary.tax = false;
                    try{
                       record.lastName.length;
                       summary.salary = record.salary;
                       if (record.age < 50 || record.salary>100000){
                           summary.tax = true;}
                    }catch(exc){
                       //ignore
                    }
                    result.push(summary);
                }
                return result;
            };

            var calculateSalary = function(result){

                for (var i=0; i<result.length; i++){
                    var finalSalary = {};
                    var record = result[i];
                    var baz = record.salary;
                    if (record.tax){
                        finalSalary.value = record.salary;
                    }else{
                        finalSalary.value = record.salary*2;
                    };
                    if  (finalSalary.value >= 200000){
                        console.log("Error : Salary is higher than limit : " + finalSalary.value + " >= 200000");
                    } else {
                        console.log(i + ") The salary amount is : " + finalSalary.value)
                    }
                }
            };

            var getRecords = function(){
                return {
                a:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"100001"},
                c:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"100005"},
                e:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"100007"},
                j:{name:"John", lastName:"Barton", company:"IBM", age:"54", salary:"100000"},
                d:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"100555"},
                g:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"106666"},
                f:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"107777"},
                h:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"106666"},
                b:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"155555"},
                i:{name:"John", lastName:"Barton", company:"IBM", age:"44", salary:"177777"},
                };
            };

        -->
        </script>

    </head>

    <body id="myBody">
    <h3>
        Background:
    </h3>
    <p>
        Open firebug and select console panel. Once you click on the button (Calculate Salaries!), a
            list of calculated salaries will appear. In one of lines you see an error.
            Locate the defect cause this error.
        
    </P>

    <button id="myParagraph" onclick="compute()">
      Calculate Salaries!
    </button>

    <p id>

    </p>
    </body>

</html>